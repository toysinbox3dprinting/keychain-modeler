# Architecture

## Layers
- UI (`src/ui/*`)
  - Editor page orchestration, editor components, styles, and static assets.
- Core (`src/core/*`)
  - Modeling logic, geometry primitives/adapters, and vendored CSG.
- Infra (`src/infra/*`)
  - Cloud conversion/slicing client, desktop bridge wrappers, and environment config.
- App (`src/app/*`)
  - Router/bootstrap and app-level configuration.
- Electron (`electron/*`)
  - Main process, preload bridge, and IPC handlers.

## Dependency direction
- UI may depend on Core and Infra.
- Core is pure modeling/geometry logic and must not depend on UI.
- Infra encapsulates network concerns and must not depend on UI.
- App wires routes/config and depends on UI.
- Editor orchestration goes through `src/ui/pages/editorController.ts`.
- Electron main/preload are isolated from renderer and communicate only via IPC.

## Import boundaries and aliases
- TypeScript aliases:
  - `@app/* -> src/app/*`
  - `@ui/* -> src/ui/*`
  - `@core/* -> src/core/*`
  - `@infra/* -> src/infra/*`
- ESLint rules enforce boundaries:
  - `src/core/*` cannot import UI/Infra.
  - `src/infra/*` cannot import UI.

## Current decisions
- Subpath routing is configuration-driven via `REACT_APP_BASE_PATH`.
- Production artifact generation is script-driven (`build:artifact`) and does not mutate source files.
- Vendored CSG and earcut are consumed via committed ESM adapter bundles for Vite compatibility:
  - `src/core/vendor/csg/dist/api.esm.js`
  - `src/core/vendor/csg/dist/csg.esm.js`
  - `src/core/geometry/earcut.esm.js`
- Adapter bundles are generated by `npm run generate:adapters` and verified by `npm run verify:adapters`.
- Electron desktop target is additive:
  - Renderer remains Vite React (`src/*`)
  - Main/preload built to `dist-electron/`
  - Desktop file save is handled through preload-exposed `window.desktop`.
  - Main process denies window opens/navigation outside allowed app origins.
  - Renderer save flow falls back to browser download if desktop IPC save fails.
